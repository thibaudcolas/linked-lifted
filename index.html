<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="Linked-lifted : New user interfaces for interconnection modules" />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Linked-lifted</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/ThibWeb/linked-lifted">View on GitHub</a>

          <h1 id="project_title">Linked-lifted</h1>
          <h2 id="project_tagline">New user interfaces for interconnection modules</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/ThibWeb/linked-lifted/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/ThibWeb/linked-lifted/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>Module development for Datalift</h1>

<h2>Datalift architecture</h2>

<p>The <a>Datalift</a> publishing platform is developed on a large technology stack.
Server-side :</p>

<p><em>TODO</em></p>

<p>Client-side :</p>

<p><em>TODO</em></p>

<h2>Overview of the development workflow</h2>

<p>Datalift can be deployed in two ways :</p>

<ul>
<li>During development, inside an application server like Tomcat.</li>
<li>In a production environment, as a native stand-alone application.</li>
</ul><p>Here we'll look at how to automate our development workflow divided into three steps : </p>

<ol>
<li>Module source code compilation.</li>
<li>Jar deployment inside the Datalift home.</li>
<li>Refreshing our modifications.</li>
</ol><h3>Compilation with Ant</h3>

<p>Datalift and its modules must be compiled using the <a title="Ant build tool">Ant</a> Java building tool. The Datalift architecture and each of its modules have their own Ant build file which will create one JAR per module according to its own rules.
For a given module, the command to compile its sources and retrieve its JAR is <code>ant dist</code> : call to the dist target of our build.xml file.</p>

<p>We can call it from our own script using :</p>

<pre><code>&lt;target name="compile"&gt;
    &lt;subant target="dist"&gt;
        &lt;filelist dir="${project.code}" files="${module.name}"/&gt;
    &lt;/subant&gt;
&lt;/target&gt;
</code></pre>

<h3>Deployment within Tomcat</h3>

<p>Once the JAR is created, it must be placed inside the "modules" directory of the Datalift installation directory. In a development environment, its path is <code>../datalift-home/modules</code>.
It is unneccesary to redeploy the WAR nor the whole datalift-home at every modification to our module.</p>

<pre><code>&lt;target name="deploy" depends="compile, transfer"/&gt;


&lt;target name="transfer"&gt;
    &lt;copy file="${module.jar}" todir="${project.modules}" overwrite="true"/&gt;
&lt;/target&gt;
</code></pre>

<p><strong>/!\</strong> If our modifications only affect static HTML code, the JAR transfer will suffice to update our HTML rendering. Otherwise, we'll also have to reload Tomcat.</p>

<pre><code>&lt;target name="reload" depends="stop, deploy, start"/&gt;

&lt;target name="stop"&gt;
    &lt;java jar="${tomcat.bootstrap}" fork="true" spawn="true"&gt;
        &lt;jvmarg value="-Dcatalina.home=${tomcat.home}"/&gt;
        &lt;arg line="stop"/&gt;
    &lt;/java&gt;
    &lt;waitfor maxwait="3000" checkevery="1000"&gt;
        &lt;not&gt;
            &lt;socket server="${tomcat.server}" port="${tomcat.port}"/&gt;
        &lt;/not&gt;
    &lt;/waitfor&gt;
    &lt;exec executable="say" spawn="yes"&gt;
    &lt;arg line="${tomcat.msg.stop}"/&gt;
&lt;/exec&gt;
&lt;exec executable="growlnotify" spawn="yes"&gt;
    &lt;arg line="growlnotify -a 'Tomcat Controller' -m '${tomcat.msg.stop}'"/&gt;
&lt;/exec&gt;
&lt;/target&gt;
</code></pre>

<p>We wait for Tomcat not to answer anymore to judge it stopped. We use <code>say</code> and <code>growlnotify</code> to make our lives easier.</p>

<pre><code>&lt;target name="start"&gt;
    &lt;java jar="${tomcat.bootstrap}" fork="true" spawn="true"&gt;
        &lt;jvmarg value="-Dcatalina.home=${tomcat.home}"/&gt;
        &lt;jvmarg value="-Ddatalift.home=${project.home}"/&gt;
    &lt;/java&gt;
    &lt;waitfor maxwait="10000" checkevery="1000"&gt;
        &lt;http url="${module.url}"/&gt;
    &lt;/waitfor&gt;
    &lt;exec executable="say" spawn="yes"&gt;
    &lt;arg line="${tomcat.msg.start}"/&gt;
&lt;/exec&gt;
&lt;exec executable="growlnotify" spawn="yes"&gt;
    &lt;arg line="growlnotify -a 'Tomcat Controller' -m '${tomcat.msg.start}'"/&gt;
&lt;/exec&gt;
&lt;/target&gt;
</code></pre>

<p>The <code>datalift.home</code> argument is used to target the datalift-home directory where our modules and configuration files are. We wait for our module's URL to be retrieved to let the start process pass.</p>

<h3>Results refreshing</h3>

<p>To maximize automation, we don't want to have to manually refresh our HTML rendering. In order to do so, we can use the <code>ant open</code> command which will automatically open the module URL into our default browser. With this method we'll still have to go to the command line.</p>

<pre><code>&lt;target name="open"&gt;
    &lt;exec executable="open" spawn="yes"&gt;
        &lt;arg line="${module.url}"/&gt;
    &lt;/exec&gt;
&lt;/target&gt;
</code></pre>

<p>To not have to use the command line, we use <a>LiveReload</a>. LiveReload monitors our module's source code and automatically triggers browser refresh each time a modification is detected. LiveReload also allows to preceed each refresh by a script execution, thus we're going to use it to fully automate our workflow :</p>

<ul>
<li>At any modification inside the <code>web</code> directory, LiveReload will execute <code>ant -buildfile live-build.xml deploy</code>, which will update the JAR file.</li>
<li>At any modification inside the <code>java</code> directory, which requires Tomcat to be reloaded, we'll launch <code>ant -buildfile ../../live-build.xml reload</code>.</li>
</ul><p>All that's left to do is tell LiveReload to focus on .vm, .java and .properties files and the update process will be triggered at each file save.</p>

<p>Our development cycle can be further optimized by hosting our .css and .js files outside of our module : they'll be hosted on another local HTTP server : they are stored in /modulepath/src/web/public and made available with <code>open http://localhost:8000 &amp;&amp; python -m SimpleHTTPServer</code>. LiveReload can be told to monitor the public folder and to automatically refresh the browser, without needing to redeploy our JAR.</p>

<h2>StringToURI integration</h2>

<p>As a linked data publishing platform, Datalift needs dataset interconnection modules.</p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Linked-lifted maintained by <a href="https://github.com/ThibWeb">ThibWeb</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
